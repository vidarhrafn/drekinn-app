<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Innl√∂gn ‚Äì Byrjun ‚Äì M√°lst√∂√∞in</title>
  <script src="lesson-config.js"></script>
  <script src="lesson-navigation.js"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    .vocab-word {
      text-decoration: underline;
      text-decoration-style: dotted;
      text-decoration-color: #1565c0;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
      padding: 0 2px;
    }
    .vocab-word:hover {
      background-color: #e3f2fd;
      text-decoration-style: solid;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    async function callOpenAI(payload) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }

    const Innlogn = () => {
      const [savedLanguage, setSavedLanguage] = useState('English');
      const [popup, setPopup] = useState(null);
      const [loadingTranslation, setLoadingTranslation] = useState(false);
      const [translatedHint, setTranslatedHint] = useState('');
      const [lessonInfo, setLessonInfo] = useState(null);

      useEffect(() => {
        const saved = localStorage.getItem('userLanguage') || 'English';
        setSavedLanguage(saved);
        translateHint(saved);
        
        // Get lesson info
        const info = getLessonInfo('innlogn');
        setLessonInfo(info);
      }, []);

      const translateHint = async (lang) => {
        try {
          const sys = `Translate this instruction to ${lang}: "Tip: Click on underlined words to see translation in your native language!" Return ONLY the translation, nothing else.`;
          
          const response = await callOpenAI({
            model: 'gpt-4o',
            temperature: 0.3,
            max_tokens: 100,
            messages: [
              { role: 'system', content: sys },
              { role: 'user', content: 'Translate please' }
            ]
          });

          setTranslatedHint(response.trim());
        } catch (e) {
          console.error('Hint translation error:', e);
        }
      };

      const translateWord = async (word) => {
        if (!savedLanguage) {
          setPopup({ word, translation: 'Veldu fyrst √æitt m√≥√∞urm√°l!' });
          return;
        }

        setLoadingTranslation(true);
        setPopup({ word, translation: '...' });

        try {
          const sys = `You are a helpful translation assistant. Translate the Icelandic word "${word}" to ${savedLanguage}. Return ONLY the translation, nothing else. If it's a verb, give the infinitive form.`;
          
          const response = await callOpenAI({
            model: 'gpt-4o',
            temperature: 0.3,
            max_tokens: 50,
            messages: [
              { role: 'system', content: sys },
              { role: 'user', content: word }
            ]
          });

          setPopup({ word, translation: response.trim() });
        } catch (e) {
          console.error('Translation error:', e);
          setPopup({ word, translation: 'Villa vi√∞ √æ√Ω√∞ingu' });
        } finally {
          setLoadingTranslation(false);
        }
      };

      const VocabWord = ({ children }) => (
        <span 
          className="vocab-word"
          onClick={() => translateWord(children)}
        >
          {children}
        </span>
      );

      return (
        <div className="min-h-screen pb-12">
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-6 py-8">
              <button 
                onClick={() => window.history.back()} 
                className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light"
              >
                ‚Üê Til baka
              </button>
              <h1 className="text-3xl font-light text-gray-800 mb-2">Byrjun</h1>
              <p className="text-gray-500 text-sm font-light">√Üfingar fyrir byrjendur ¬∑ A1</p>
            </div>
          </header>

          <main className="max-w-4xl mx-auto px-6 mt-8">
            {/* Progress Bar */}
            {lessonInfo && (
              <div className="bg-white rounded-lg shadow-sm p-6 mb-6 border border-gray-200">
                <div className="flex justify-between items-center mb-3">
                  <span className="text-sm text-gray-600 font-light">
                    Skref {lessonInfo.index + 1} af {lessonInfo.total}
                  </span>
                  <span className="text-lg text-blue-600 font-medium">
                    {Math.round(((lessonInfo.index + 1) / lessonInfo.total) * 100)}%
                  </span>
                </div>
                <div className="w-full h-2 bg-gray-200 rounded-full overflow-hidden mb-4">
                  <div 
                    className="h-full bg-gradient-to-r from-blue-500 to-blue-600 rounded-full transition-all duration-500"
                    style={{ width: `${((lessonInfo.index + 1) / lessonInfo.total) * 100}%` }}
                  ></div>
                </div>
                <div className="flex gap-2 mb-3">
                  {LESSON_CONFIG.lessons.map((lesson, i) => (
                    <div 
                      key={lesson.id}
                      className={`flex-1 h-3 rounded-full transition-all ${
                        i < lessonInfo.index ? 'bg-green-500' :
                        i === lessonInfo.index ? 'bg-blue-500' :
                        'bg-gray-200'
                      }`}
                    ></div>
                  ))}
                </div>
                <div className="flex flex-wrap gap-2 text-xs text-gray-500">
                  {LESSON_CONFIG.lessons.map((lesson, i) => (
                    <React.Fragment key={lesson.id}>
                      <span className={`${
                        i < lessonInfo.index ? 'text-green-600 font-medium' :
                        i === lessonInfo.index ? 'text-blue-600 font-semibold' :
                        'text-gray-400'
                      }`}>
                        {lesson.icon} {lesson.name}
                      </span>
                      {i < LESSON_CONFIG.lessons.length - 1 && <span className="text-gray-300">‚Üí</span>}
                    </React.Fragment>
                  ))}
                </div>
              </div>
            )}

            {/* Navigation Top */}
            {lessonInfo && (
              <div className="flex justify-between gap-4 mb-6">
                {lessonInfo.prev ? (
                  <a 
                    href={lessonInfo.prev.url}
                    className="flex-1 px-6 py-3 bg-white border-2 border-gray-200 rounded-lg text-gray-700 hover:border-blue-500 hover:text-blue-600 transition-all text-center font-light"
                  >
                    ‚Üê {lessonInfo.prev.name}
                  </a>
                ) : (
                  <a 
                    href="byrjun.html"
                    className="flex-1 px-6 py-3 bg-white border-2 border-gray-200 rounded-lg text-gray-700 hover:border-blue-500 hover:text-blue-600 transition-all text-center font-light"
                  >
                    ‚Üê Til baka
                  </a>
                )}
                
                {lessonInfo.next ? (
                  <a 
                    href={lessonInfo.next.url}
                    className="flex-1 px-6 py-3 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-all text-center font-light"
                  >
                    {lessonInfo.next.name} ‚Üí
                  </a>
                ) : (
                  <a 
                    href="byrjun.html"
                    className="flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition-all text-center font-light"
                  >
                    üéâ Kl√°ra√∞!
                  </a>
                )}
              </div>
            )}
            
            {/* Language Info */}
            <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
              <div className="flex items-center justify-between mb-3">
                <p className="text-sm text-gray-600 font-light">
                  üåç M√≥√∞urm√°l: <strong>{savedLanguage}</strong>
                </p>
                <a 
                  href="byrjun.html" 
                  className="text-sm text-blue-600 hover:underline font-light"
                >
                  Breyta
                </a>
              </div>

              <div className="p-4 bg-blue-50 rounded-lg border border-blue-200">
                <p className="text-sm text-blue-800 font-light">
                  üí° {translatedHint ? (
                    <><strong>√Åbending:</strong> {translatedHint}</>
                  ) : (
                    <><strong>√Åbending:</strong> Smelltu √° undirstriku√∞ or√∞ til a√∞ sj√° √æ√Ω√∞ingu √° √æ√≠nu m√≥√∞urm√°li!</>
                  )}
                </p>
              </div>
            </div>

            {/* Introduction Text */}
            <div className="bg-white rounded-lg shadow-sm p-8 mb-8">
              <div className="prose prose-lg max-w-none space-y-4">
                <p className="text-gray-700 leading-relaxed font-light text-lg">
                  H√¶! √âg <VocabWord>heiti</VocabWord> <VocabWord>Mia</VocabWord>. √âg <VocabWord>er</VocabWord> fr√° <VocabWord>√ökra√≠nu</VocabWord>. √âg <VocabWord>kom</VocabWord> til <VocabWord>√çslands</VocabWord> √°ri√∞ 2023. √âg <VocabWord>b√Ω</VocabWord> √≠ <VocabWord>Reykjav√≠k</VocabWord> <VocabWord>n√∫na</VocabWord>.
                </p>

                <p className="text-gray-700 leading-relaxed font-light text-lg">
                  √âg <VocabWord>er</VocabWord> 28 <VocabWord>√°ra</VocabWord>. √âg <VocabWord>er</VocabWord> <VocabWord>leiksk√≥lakennari</VocabWord>. √âg <VocabWord>vinn</VocabWord> √° <VocabWord>leiksk√≥la</VocabWord> me√∞ <VocabWord>litlum</VocabWord> <VocabWord>b√∂rnum</VocabWord>. √âg <VocabWord>elska</VocabWord> <VocabWord>starfi√∞</VocabWord> mitt.
                </p>

                <p className="text-gray-700 leading-relaxed font-light text-lg">
                  √âg <VocabWord>tala</VocabWord> <VocabWord>√∫kra√≠nsku</VocabWord> og <VocabWord>ensku</VocabWord>. √âg <VocabWord>er</VocabWord> a√∞ <VocabWord>l√¶ra</VocabWord> <VocabWord>√≠slensku</VocabWord> <VocabWord>n√∫na</VocabWord>. <VocabWord>√çslenska</VocabWord> <VocabWord>er</VocabWord> <VocabWord>erfi√∞</VocabWord> en <VocabWord>skemmtileg</VocabWord>. √âg <VocabWord>skil</VocabWord> <VocabWord>miki√∞</VocabWord> en <VocabWord>tala</VocabWord> ekki <VocabWord>miki√∞</VocabWord> <VocabWord>enn√æ√°</VocabWord>.
                </p>

                <p className="text-gray-700 leading-relaxed font-light text-lg">
                  √Å <VocabWord>morgnana</VocabWord> <VocabWord>drekk</VocabWord> √©g <VocabWord>kaffi</VocabWord> og <VocabWord>bor√∞a</VocabWord> <VocabWord>brau√∞</VocabWord>. √âg <VocabWord>fer</VocabWord> √° <VocabWord>leiksk√≥lann</VocabWord> klukkan <VocabWord>√°tta</VocabWord>. Eftir <VocabWord>vinnu</VocabWord> <VocabWord>fer</VocabWord> √©g √≠ <VocabWord>l√≠kamsr√¶kt</VocabWord> e√∞a √° <VocabWord>kaffih√∫s</VocabWord> me√∞ <VocabWord>vinum</VocabWord>.
                </p>

                <p className="text-gray-700 leading-relaxed font-light text-lg">
                  Um <VocabWord>helgar</VocabWord> <VocabWord>vil</VocabWord> √©g <VocabWord>fara</VocabWord> <VocabWord>√∫t</VocabWord> √≠ <VocabWord>n√°tt√∫runa</VocabWord>. √âg <VocabWord>elska</VocabWord> a√∞ <VocabWord>taka</VocabWord> <VocabWord>myndir</VocabWord>. <VocabWord>Stundum</VocabWord> <VocabWord>fer</VocabWord> √©g √≠ <VocabWord>b√≠√≥</VocabWord> e√∞a <VocabWord>les</VocabWord> <VocabWord>b√≥k</VocabWord> <VocabWord>heima</VocabWord>.
                </p>
              </div>
            </div>

            {/* Navigation Bottom */}
            {lessonInfo && (
              <div className="flex justify-between gap-4 mt-8">
                {lessonInfo.prev ? (
                  <a 
                    href={lessonInfo.prev.url}
                    className="flex-1 px-6 py-3 bg-white border-2 border-gray-200 rounded-lg text-gray-700 hover:border-blue-500 hover:text-blue-600 transition-all text-center font-light"
                  >
                    ‚Üê {lessonInfo.prev.name}
                  </a>
                ) : (
                  <a 
                    href="byrjun.html"
                    className="flex-1 px-6 py-3 bg-white border-2 border-gray-200 rounded-lg text-gray-700 hover:border-blue-500 hover:text-blue-600 transition-all text-center font-light"
                  >
                    ‚Üê Til baka
                  </a>
                )}
                
                {lessonInfo.next ? (
                  <a 
                    href={lessonInfo.next.url}
                    className="flex-1 px-6 py-3 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-all text-center font-light"
                  >
                    {lessonInfo.next.name} ‚Üí
                  </a>
                ) : (
                  <a 
                    href="byrjun.html"
                    className="flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition-all text-center font-light"
                  >
                    üéâ Kl√°ra√∞!
                  </a>
                )}
              </div>
            )}

            {/* Translation Popup */}
            {popup && (
              <div 
                className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
                onClick={() => setPopup(null)}
              >
                <div 
                  className="bg-white rounded-lg shadow-xl p-6 max-w-md w-full"
                  onClick={(e) => e.stopPropagation()}
                >
                  <div className="flex justify-between items-start mb-4">
                    <h3 className="text-xl font-light text-gray-800">√û√Ω√∞ing</h3>
                    <button 
                      onClick={() => setPopup(null)}
                      className="text-gray-400 hover:text-gray-600 text-2xl leading-none"
                    >
                      √ó
                    </button>
                  </div>
                  <div className="space-y-3">
                    <div>
                      <p className="text-sm text-gray-500 font-light">√çslenska:</p>
                      <p className="text-2xl font-normal text-gray-800">{popup.word}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500 font-light">{savedLanguage || '√û√Ω√∞ing'}:</p>
                      <p className="text-2xl font-normal text-blue-600">
                        {loadingTranslation ? '...' : popup.translation}
                      </p>
                    </div>
                  </div>
                  <button
                    onClick={() => setPopup(null)}
                    className="mt-6 w-full bg-gray-800 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors font-light"
                  >
                    Loka
                  </button>
                </div>
              </div>
            )}
          </main>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<Innlogn />);
  </script>
</body>
</html>
