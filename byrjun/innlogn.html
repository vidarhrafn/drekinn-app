<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Innl√∂gn ‚Äì Byrjun ‚Äì M√°lst√∂√∞in</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    .vocab-word {
      text-decoration: underline;
      text-decoration-style: dotted;
      text-decoration-color: #1565c0;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
    }
    .vocab-word:hover {
      background-color: #e3f2fd;
      text-decoration-style: solid;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    async function callOpenAI(payload) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }

    const Innlogn = () => {
      const [language, setLanguage] = useState('');
      const [savedLanguage, setSavedLanguage] = useState('');
      const [popup, setPopup] = useState(null);
      const [loadingTranslation, setLoadingTranslation] = useState(false);

      useEffect(() => {
        const saved = localStorage.getItem('userLanguage');
        if (saved) {
          setSavedLanguage(saved);
          setLanguage(saved);
        }
      }, []);

      const saveLanguage = () => {
        if (language.trim()) {
          localStorage.setItem('userLanguage', language.trim());
          setSavedLanguage(language.trim());
        }
      };

      const translateWord = async (word) => {
        if (!savedLanguage) {
          setPopup({ word, translation: 'Veldu fyrst √æitt m√≥√∞urm√°l!' });
          return;
        }

        setLoadingTranslation(true);
        setPopup({ word, translation: '...' });

        try {
          const sys = `You are a helpful translation assistant. Translate the Icelandic word "${word}" to ${savedLanguage}. Return ONLY the translation, nothing else. If it's a verb, give the infinitive form.`;
          
          const response = await callOpenAI({
            model: 'gpt-4o',
            temperature: 0.3,
            max_tokens: 50,
            messages: [
              { role: 'system', content: sys },
              { role: 'user', content: word }
            ]
          });

          setPopup({ word, translation: response.trim() });
        } catch (e) {
          console.error('Translation error:', e);
          setPopup({ word, translation: 'Villa vi√∞ √æ√Ω√∞ingu' });
        } finally {
          setLoadingTranslation(false);
        }
      };

      const VocabWord = ({ children }) => (
        <span 
          className="vocab-word"
          onClick={() => translateWord(children)}
        >
          {children}
        </span>
      );

      return (
        <div className="min-h-screen pb-12">
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-6 py-8">
              <button 
                onClick={() => window.history.back()} 
                className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light"
              >
                ‚Üê Til baka
              </button>
              <h1 className="text-3xl font-light text-gray-800 mb-2">Byrjun</h1>
              <p className="text-gray-500 text-sm font-light">√Üfingar fyrir byrjendur ¬∑ A1</p>
            </div>
          </header>

          <main className="max-w-4xl mx-auto px-6 mt-8">
            {/* Language Selection */}
            <div className="bg-white rounded-lg shadow-sm p-6 mb-8">
              <div className="flex items-center gap-4">
                <div className="flex-1">
                  <label className="block text-sm font-light text-gray-600 mb-2">
                    üåç Hva√∞ er √æitt m√≥√∞urm√°l?
                  </label>
                  <input
                    type="text"
                    value={language}
                    onChange={(e) => setLanguage(e.target.value)}
                    onKeyDown={(e) => e.key === 'Enter' && saveLanguage()}
                    placeholder="t.d. English, Espa√±ol, Polski..."
                    className="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400 font-light"
                  />
                </div>
                <button
                  onClick={saveLanguage}
                  className="mt-6 bg-gray-800 text-white px-6 py-2 rounded-md hover:bg-gray-700 transition-colors font-light"
                >
                  Vista
                </button>
              </div>
              {savedLanguage && (
                <p className="text-sm text-green-600 mt-2 font-light">
                  ‚úì M√≥√∞urm√°l vista√∞: {savedLanguage}
                </p>
              )}
            </div>

            {/* Introduction Text */}
            <div className="bg-white rounded-lg shadow-sm p-8 mb-8">
              <div className="prose prose-lg max-w-none">
                <p className="text-gray-700 leading-relaxed mb-4 font-light text-lg">
                  Hall√≥ og velkomin/n! √ûetta er byrjunarefni fyrir √æig sem ert a√∞ <VocabWord>l√¶ra</VocabWord> √≠slensku. 
                  H√©r getur√∞u <VocabWord>√¶ft</VocabWord> grunninn - √æa√∞ sem √æ√∫ √æarft til a√∞ <VocabWord>tala</VocabWord> og 
                  <VocabWord>skilja</VocabWord> √≠ daglegu l√≠fi.
                </p>

                <p className="text-gray-700 leading-relaxed mb-4 font-light text-lg">
                  √ç √¶fingunum h√©r fyrir ne√∞an muntu nota or√∞ eins og "<VocabWord>heita</VocabWord>", 
                  "<VocabWord>vera</VocabWord>", "<VocabWord>b√∫a</VocabWord>", "<VocabWord>koma</VocabWord> fr√°" 
                  og "<VocabWord>tala</VocabWord>". √ûetta eru or√∞in sem √æ√∫ notar √æegar √æ√∫ <VocabWord>kynnir</VocabWord> √æig 
                  fyrir f√≥lki. Til d√¶mis: "√âg <VocabWord>heiti</VocabWord> Anna. √âg <VocabWord>er</VocabWord> fr√° Sv√≠√æj√≥√∞. 
                  √âg <VocabWord>b√Ω</VocabWord> √≠ Reykjav√≠k og √©g <VocabWord>tala</VocabWord> √≠slensku og ensku."
                </p>

                <p className="text-gray-700 leading-relaxed mb-4 font-light text-lg">
                  √û√∫ munt l√≠ka <VocabWord>l√¶ra</VocabWord> a√∞ <VocabWord>panta</VocabWord> √° kaffih√∫si. 
                  √û√° notar√∞u or√∞ eins og "<VocabWord>vilja</VocabWord>", "<VocabWord>f√°</VocabWord>", 
                  "<VocabWord>taka</VocabWord>" og "<VocabWord>bor√∞a</VocabWord>". Til d√¶mis: "√âg <VocabWord>vil</VocabWord> f√° 
                  <VocabWord>kaffi</VocabWord> og <VocabWord>k√∂kur</VocabWord>."
                </p>

                <p className="text-gray-700 leading-relaxed mb-4 font-light text-lg">
                  √ûa√∞ er alveg √≠ lagi a√∞ <VocabWord>gera</VocabWord> villur! √ûa√∞ er hluti af √æv√≠ a√∞ 
                  <VocabWord>l√¶ra</VocabWord>. Gervigreindin <VocabWord>hj√°lpar</VocabWord> √æ√©r og 
                  <VocabWord>lei√∞r√©ttir</VocabWord> √æig √° g√≥√∞an h√°tt. √û√∫ f√¶r√∞ hr√≥s fyrir √æa√∞ sem √æ√∫ 
                  <VocabWord>gerir</VocabWord> r√©tt!
                </p>

                <p className="text-gray-700 leading-relaxed font-light text-lg">
                  Ef √æ√∫ <VocabWord>skilur</VocabWord> ekki or√∞, getur√∞u <VocabWord>smellt</VocabWord> √° √æa√∞ og 
                  <VocabWord>fengi√∞</VocabWord> √æ√Ω√∞ingu √° √æ√≠nu m√≥√∞urm√°li. Gangi √æ√©r vel! üéâ
                </p>
              </div>

              <div className="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <p className="text-sm text-blue-800 font-light">
                  üí° <strong>√Åbending:</strong> Smelltu √° undirstriku√∞ or√∞ til a√∞ sj√° √æ√Ω√∞ingu √° √æ√≠nu m√≥√∞urm√°li!
                </p>
              </div>
            </div>

            {/* Translation Popup */}
            {popup && (
              <div 
                className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
                onClick={() => setPopup(null)}
              >
                <div 
                  className="bg-white rounded-lg shadow-xl p-6 max-w-md w-full"
                  onClick={(e) => e.stopPropagation()}
                >
                  <div className="flex justify-between items-start mb-4">
                    <h3 className="text-xl font-light text-gray-800">√û√Ω√∞ing</h3>
                    <button 
                      onClick={() => setPopup(null)}
                      className="text-gray-400 hover:text-gray-600 text-2xl leading-none"
                    >
                      √ó
                    </button>
                  </div>
                  <div className="space-y-3">
                    <div>
                      <p className="text-sm text-gray-500 font-light">√çslenska:</p>
                      <p className="text-2xl font-normal text-gray-800">{popup.word}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500 font-light">{savedLanguage || '√û√Ω√∞ing'}:</p>
                      <p className="text-2xl font-normal text-blue-600">
                        {loadingTranslation ? '...' : popup.translation}
                      </p>
                    </div>
                  </div>
                  <button
                    onClick={() => setPopup(null)}
                    className="mt-6 w-full bg-gray-800 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors font-light"
                  >
                    Loka
                  </button>
                </div>
              </div>
            )}
          </main>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<Innlogn />);
  </script>
</body>
</html>
