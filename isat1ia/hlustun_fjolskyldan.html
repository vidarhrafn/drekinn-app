<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéß Hlustun 1: Fj√∂lskyldan ‚Äì √çSAT1√çA</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    .sticky-player {
      position: sticky;
      top: 0;
      z-index: 50;
      background: white;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    .answer-option {
      border: 2px solid #e0e0e0;
      transition: all 0.2s;
      cursor: pointer;
    }
    .answer-option:hover:not(.disabled) {
      border-color: #2196f3;
      background: #e3f2fd;
    }
    .answer-option.selected {
      border-color: #2196f3;
      background: #e3f2fd;
    }
    .answer-option.correct {
      border-color: #4caf50;
      background: #e8f5e9;
    }
    .answer-option.incorrect {
      border-color: #f44336;
      background: #ffebee;
    }
    .answer-option.disabled {
      cursor: default;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    async function callOpenAI(payload) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }

    const ORIGINAL_TEXT = "gift (a√∞ vera gift/giftur)";

    const MULTIPLE_CHOICE = [
      {
        question: 'Hvar b√∫a Sigur√∞ur og Anna?',
        options: ['√ç √≠b√∫√∞ √≠ Reykjav√≠k', '√ç ra√∞h√∫si √≠ Hafnarfir√∞i', '√ç einb√Ωlish√∫si √° Akureyri', '√ç ra√∞h√∫si √≠ K√≥pavogi'],
        correct: 1
      },
      {
        question: 'Hva√∞ vinnur Anna?',
        options: ['Tannl√¶knir', 'Kennari', 'B√≥kasafnsfulltr√∫i', 'Hj√∫krunarfr√¶√∞ingur'],
        correct: 2
      },
      {
        question: 'Hversu gamall er Bjarki?',
        options: ['8 √°ra', '10 √°ra', '13 √°ra', '15 √°ra'],
        correct: 2
      },
      {
        question: 'Hva√∞ gerir Bjarki?',
        options: ['Fer √≠ karate', 'Spilar f√≥tbolta', 'Spilar √° g√≠tar', 'Syndir'],
        correct: 2
      },
      {
        question: 'Hversu oft fer Lilja √≠ karate?',
        options: ['Einu sinni √≠ viku', 'Tvisvar √≠ viku', '√ûrisvar √≠ viku', 'Fj√≥rum sinnum √≠ viku'],
        correct: 2
      },
      {
        question: 'Hva√∞ heitir k√∂tturinn?',
        options: ['Bjarki', 'M√°si', 'Fluffy', 'Kettlingur'],
        correct: 1
      }
    ];

    const OPEN_QUESTIONS = [
      { 
        question: 'Hva√∞ vinnur Sigur√∞ur og hvar?',
        expectedContent: ['tannl√¶knir', 'K√≥pavogi', 'K√≥pavogur']
      },
      { 
        question: 'Hva√∞ gerir fj√∂lskyldan um helgar?',
        expectedContent: ['g√∂ngut√∫ra', 'Esju', 'str√∂ndinni', 'ganga', 't√∫ra']
      },
      { 
        question: 'Hva√∞ gerir Anna √° laugard√∂gum?',
        expectedContent: ['bakar', 'brau√∞', 'n√Ωbaka√∞']
      },
      { 
        question: 'Hva√∞a √≠√ær√≥ttaf√©lagi heldur Sigur√∞ur me√∞?',
        expectedContent: ['FH']
      }
    ];

    const TRUE_FALSE = [
      { statement: 'Anna vinnur √° sj√∫krah√∫si.', correct: false },
      { statement: 'Sigur√∞ur er tannl√¶knir √≠ K√≥pavogi.', correct: true },
      { statement: 'Bjarki fer oft √° t√≥nleika √≠ t√≥nlistarsk√≥lanum.', correct: true },
      { statement: 'Lilja er 10 √°ra.', correct: false },
      { statement: 'Fj√∂lskyldan √° hund.', correct: false },
      { statement: 'Sigur√∞ur elskar a√∞ horfa √° f√≥tbolta.', correct: true }
    ];

    const MATCHING = [
      { left: 'Sigur√∞ur', right: 'Tannl√¶knir √≠ K√≥pavogi' },
      { left: 'Anna', right: 'Vinnur √° b√≥kasafni' },
      { left: 'Bjarki', right: 'Spilar √° g√≠tar' },
      { left: 'Lilja', right: 'Fer √≠ karate √ærisvar √≠ viku' },
      { left: 'M√°si', right: 'K√∂ttur sem liggur √≠ s√≥fanum' }
    ];

    const HlustunFjolskyldan = () => {
      const [playbackRate, setPlaybackRate] = useState(1);
      const [isPlaying, setIsPlaying] = useState(false);
      const audioRef = useRef(null);

      // Translation question
      const [translationAnswer, setTranslationAnswer] = useState('');
      const [translationLanguage, setTranslationLanguage] = useState('');
      const [translationFeedback, setTranslationFeedback] = useState(null);
      const [translationLoading, setTranslationLoading] = useState(false);

      // Multiple choice
      const [mcAnswers, setMcAnswers] = useState([]);
      const [mcChecked, setMcChecked] = useState(false);

      // Open questions
      const [openAnswers, setOpenAnswers] = useState(Array(OPEN_QUESTIONS.length).fill(''));
      const [openFeedback, setOpenFeedback] = useState(Array(OPEN_QUESTIONS.length).fill(null));
      const [openLoading, setOpenLoading] = useState(Array(OPEN_QUESTIONS.length).fill(false));

      // True/False
      const [tfAnswers, setTfAnswers] = useState([]);
      const [tfChecked, setTfChecked] = useState(false);

      // Matching
      const [matchingAnswers, setMatchingAnswers] = useState(Array(MATCHING.length).fill(''));
      const [matchingChecked, setMatchingChecked] = useState(false);

      useEffect(() => {
        if (audioRef.current) {
          audioRef.current.playbackRate = playbackRate;
        }
      }, [playbackRate]);

      const togglePlay = () => {
        if (audioRef.current) {
          if (isPlaying) {
            audioRef.current.pause();
          } else {
            audioRef.current.play();
          }
          setIsPlaying(!isPlaying);
        }
      };

      const checkTranslation = async () => {
        if (translationAnswer.trim().length < 2) {
          alert('Vinsamlegast skrifa√∞u √æ√Ω√∞ingu!');
          return;
        }
        if (!translationLanguage.trim()) {
          alert('Vinsamlegast skrifa√∞u hva√∞a tungum√°l √æ√∫ nota√∞ir!');
          return;
        }

        setTranslationLoading(true);

        try {
          const sys = `√û√∫ ert √≠slenskukennari sem metur √æ√Ω√∞ingar nemenda.

√çSLENSKA OR√êI√ê: "${ORIGINAL_TEXT}"
NEMANDI √û√ùDDI √Å ${translationLanguage}: "${translationAnswer}"

VERKEFNI:
Meta hvort √æ√Ω√∞ingin er r√©tt. Sam√æykkja √æ√Ω√∞ingar sem √æ√Ω√∞a "married" e√∞a "to be married" √° r√©ttu tungum√°li.
Nemandinn √æarf EKKI a√∞ nefna Sigur√∞ og √ñnnu - bara √æ√Ω√∞a merkingu or√∞sins "gift".

SKILA√êU JSON (BARA JSON, EKKERT ANNA√ê):
{
  "correct": boolean,
  "feedback_is": "Endurgj√∂f √° √≠slensku",
  "feedback_native": "Endurgj√∂f √° ${translationLanguage}",
  "correct_translation": "G√≥√∞ √æ√Ω√∞ing ef rangt, annars null"
}

Vertu hvetjandi og j√°kv√¶√∞ur!`;

          const response = await callOpenAI({
            model: 'gpt-4o',
            temperature: 0.3,
            max_tokens: 300,
            messages: [
              { role: 'system', content: sys },
              { role: 'user', content: 'Meta √æ√Ω√∞ingu' }
            ]
          });

          let cleanResponse = response
            .replace(/```json\n?/g, '')
            .replace(/```\n?/g, '')
            .replace(/^[^{]*/g, '')
            .replace(/[^}]*$/g, '')
            .trim();

          const data = JSON.parse(cleanResponse);
          setTranslationFeedback(data);

        } catch (e) {
          console.error('Error checking translation:', e);
          alert('Villa vi√∞ a√∞ meta √æ√Ω√∞ingu. Reyndu aftur.');
        } finally {
          setTranslationLoading(false);
        }
      };

      const handleMcAnswer = (qIndex, optIndex) => {
        if (mcChecked) return;
        const newAnswers = [...mcAnswers];
        newAnswers[qIndex] = optIndex;
        setMcAnswers(newAnswers);
      };

      const checkMcAnswers = () => {
        if (mcAnswers.length < MULTIPLE_CHOICE.length) {
          alert('Vinsamlegast svara√∞u √∂llum spurningum!');
          return;
        }
        setMcChecked(true);
      };

      const handleOpenAnswer = (index, value) => {
        const newAnswers = [...openAnswers];
        newAnswers[index] = value;
        setOpenAnswers(newAnswers);
      };

      const checkOpenAnswer = async (index) => {
        if (openAnswers[index].trim().length < 3) {
          alert('Vinsamlegast skrifa√∞u svar!');
          return;
        }

        const newLoading = [...openLoading];
        newLoading[index] = true;
        setOpenLoading(newLoading);

        try {
          const question = OPEN_QUESTIONS[index];
          const userAnswer = openAnswers[index];

          const sys = `√û√∫ ert √≠slenskukennari sem metur sv√∂r nemenda vi√∞ opnum spurningum.

SPURNINGIN:
"${question.question}"

SVAR NEMANDA:
"${userAnswer}"

LYKILATRI√êI SEM EIGA A√ê KOMA FRAM:
${question.expectedContent.join(', ')}

VERKEFNI:
Meta hvort svari√∞ er r√©tt mi√∞a√∞ vi√∞ INNIHALD. Hunsa m√°lfr√¶√∞ivillur og stafsetningarvillur. Einbl√≠na √° hvort nemandinn skildi textann og gaf r√©tt innihald.

SKILA√êU JSON (BARA JSON, EKKERT ANNA√ê):
{
  "correct": boolean,
  "feedback": "Stutt og hvetjandi endurgj√∂f √° √≠slensku um innihaldi√∞"
}

Vertu hvetjandi og j√°kv√¶√∞ur!`;

          const response = await callOpenAI({
            model: 'gpt-4o',
            temperature: 0.3,
            max_tokens: 200,
            messages: [
              { role: 'system', content: sys },
              { role: 'user', content: 'Meta svar' }
            ]
          });

          let cleanResponse = response
            .replace(/```json\n?/g, '')
            .replace(/```\n?/g, '')
            .replace(/^[^{]*/g, '')
            .replace(/[^}]*$/g, '')
            .trim();

          const data = JSON.parse(cleanResponse);
          
          const newFeedback = [...openFeedback];
          newFeedback[index] = data;
          setOpenFeedback(newFeedback);

        } catch (e) {
          console.error('Error checking answer:', e);
          alert('Villa vi√∞ a√∞ meta svar. Reyndu aftur.');
        } finally {
          const newLoading = [...openLoading];
          newLoading[index] = false;
          setOpenLoading(newLoading);
        }
      };

      const handleTfAnswer = (index, answer) => {
        if (tfChecked) return;
        const newAnswers = [...tfAnswers];
        newAnswers[index] = answer;
        setTfAnswers(newAnswers);
      };

      const checkTfAnswers = () => {
        if (tfAnswers.length < TRUE_FALSE.length) {
          alert('Vinsamlegast svara√∞u √∂llum spurningum!');
          return;
        }
        setTfChecked(true);
      };

      const handleMatchingAnswer = (index, value) => {
        const newAnswers = [...matchingAnswers];
        newAnswers[index] = value;
        setMatchingAnswers(newAnswers);
      };

      const checkMatching = () => {
        if (matchingAnswers.some(a => !a)) {
          alert('Vinsamlegast svara√∞u √∂llum spurningum!');
          return;
        }
        setMatchingChecked(true);
      };

      const isMatchingCorrect = (index) => {
        return matchingAnswers[index] === MATCHING[index].right;
      };

      const rightOptions = MATCHING.map(m => m.right).sort(() => Math.random() - 0.5);

      return (
        <div className="min-h-screen pb-12">
          {/* Header */}
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-6 py-8">
              <button 
                onClick={() => window.history.back()} 
                className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light"
              >
                ‚Üê Til baka
              </button>
              <div className="flex items-center gap-6">
                <div className="flex-1">
                  <h1 className="text-3xl font-light text-gray-800 mb-2">Hlustun 1: Fj√∂lskyldan</h1>
                  <p className="text-gray-500 text-sm font-light">Hlustunarverkefni ¬∑ A1-A2</p>
                </div>
                <div className="hidden sm:block flex-shrink-0">
                  <img 
                    src="media/hfj_fjolskylda.png" 
                    alt="Fj√∂lskyldan" 
                    className="w-24 h-24 object-cover rounded-lg border-2 border-gray-200 shadow-sm"
                  />
                </div>
              </div>
            </div>
          </header>

          {/* Sticky Audio Player */}
          <div className="sticky-player">
            <div className="max-w-4xl mx-auto px-6 py-4">
              <div className="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border-2 border-blue-200">
                <div className="flex items-center gap-4">
                  <button
                    onClick={togglePlay}
                    className="bg-blue-500 text-white w-12 h-12 rounded-full flex items-center justify-center hover:bg-blue-600 transition-colors flex-shrink-0"
                    aria-label={isPlaying ? 'Pause' : 'Play'}
                  >
                    {isPlaying ? (
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="6" y="4" width="4" height="16" />
                        <rect x="14" y="4" width="4" height="16" />
                      </svg>
                    ) : (
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="5 3 19 12 5 21 5 3" />
                      </svg>
                    )}
                  </button>

                  <div className="flex-1">
                    <p className="text-sm font-normal text-gray-800 mb-1">üéß Hlusta √° textann</p>
                    <audio
                      ref={audioRef}
                      src="media/hlustun1_fjolskyldan.mp3"
                      onEnded={() => setIsPlaying(false)}
                      onPlay={() => setIsPlaying(true)}
                      onPause={() => setIsPlaying(false)}
                    />
                  </div>

                  <div className="flex gap-2">
                    <button
                      onClick={() => setPlaybackRate(0.75)}
                      className={`px-3 py-1 rounded-md text-sm font-light transition-colors ${
                        playbackRate === 0.75
                          ? 'bg-blue-500 text-white'
                          : 'bg-white text-gray-700 hover:bg-gray-100'
                      }`}
                    >
                      0.75√ó
                    </button>
                    <button
                      onClick={() => setPlaybackRate(1)}
                      className={`px-3 py-1 rounded-md text-sm font-light transition-colors ${
                        playbackRate === 1
                          ? 'bg-blue-500 text-white'
                          : 'bg-white text-gray-700 hover:bg-gray-100'
                      }`}
                    >
                      1√ó
                    </button>
                    <button
                      onClick={() => setPlaybackRate(1.25)}
                      className={`px-3 py-1 rounded-md text-sm font-light transition-colors ${
                        playbackRate === 1.25
                          ? 'bg-blue-500 text-white'
                          : 'bg-white text-gray-700 hover:bg-gray-100'
                      }`}
                    >
                      1.25√ó
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <main className="max-w-4xl mx-auto px-6 mt-8 space-y-8">
            
            {/* Instructions */}
            <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-6">
              <h2 className="text-xl font-normal text-gray-800 mb-3">üìù Lei√∞beiningar</h2>
              <ul className="space-y-2 text-gray-700 font-light">
                <li>‚Ä¢ Hlusta√∞u √° textann 2-3 sinnum</li>
                <li>‚Ä¢ √û√∫ getur h√¶gt e√∞a hra√∞a√∞ √° hlj√≥√∞inu</li>
                <li>‚Ä¢ Svara√∞u spurningunum h√©r a√∞ ne√∞an</li>
                <li>‚Ä¢ √û√∫ getur hlusta√∞ eins oft og √æ√∫ vilt!</li>
              </ul>
            </div>

            {/* 1. Translation Question */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">1Ô∏è‚É£ √û√Ω√∞ing</h2>
              <div className="border-2 border-gray-100 rounded-lg p-4">
                <p className="font-normal text-gray-800 mb-4">
                  Hva√∞ √æ√Ω√∞ir or√∞i√∞ <strong>"gift"</strong> (a√∞ vera gift/giftur) √° √æ√≠nu m√≥√∞urm√°li?
                </p>
                
                <input
                  type="text"
                  value={translationLanguage}
                  onChange={(e) => setTranslationLanguage(e.target.value)}
                  disabled={translationFeedback !== null}
                  placeholder="Hva√∞a tungum√°l? (t.d. enska, p√≥lska, sp√¶nska...)"
                  className="w-full p-3 mb-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light"
                />

                <textarea
                  value={translationAnswer}
                  onChange={(e) => setTranslationAnswer(e.target.value)}
                  disabled={translationFeedback !== null}
                  className="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light"
                  rows="3"
                  placeholder="Skrifa√∞u √æ√Ω√∞inguna h√©r..."
                />
                
                {!translationFeedback && (
                  <button
                    onClick={checkTranslation}
                    disabled={translationLoading}
                    className="mt-3 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 disabled:bg-gray-300 transition-colors font-light text-sm"
                  >
                    {translationLoading ? 'Athuga...' : 'Athuga √æ√Ω√∞ingu'}
                  </button>
                )}

                {translationFeedback && (
                  <div className={`mt-3 p-4 rounded-lg ${
                    translationFeedback.correct 
                      ? 'bg-green-50 border-2 border-green-200' 
                      : 'bg-yellow-50 border-2 border-yellow-200'
                  }`}>
                    <p className={`font-light mb-2 ${
                      translationFeedback.correct ? 'text-green-800' : 'text-yellow-800'
                    }`}>
                      {translationFeedback.correct ? '‚úì' : 'üí°'} {translationFeedback.feedback_is}
                    </p>
                    <p className={`text-sm font-light ${
                      translationFeedback.correct ? 'text-green-700' : 'text-yellow-700'
                    }`}>
                      {translationFeedback.feedback_native}
                    </p>
                    {translationFeedback.correct_translation && (
                      <p className="text-sm text-gray-600 mt-2 font-light">
                        <strong>D√¶mi um g√≥√∞a √æ√Ω√∞ingu:</strong> {translationFeedback.correct_translation}
                      </p>
                    )}
                  </div>
                )}
              </div>
            </section>

            {/* 2. Multiple Choice */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">2Ô∏è‚É£ Krossaspurningar</h2>
              <div className="space-y-6">
                {MULTIPLE_CHOICE.map((q, qIndex) => (
                  <div key={qIndex} className="border-2 border-gray-100 rounded-lg p-4">
                    <p className="font-normal text-gray-800 mb-4">{q.question}</p>
                    <div className="space-y-2">
                      {q.options.map((option, oIndex) => {
                        const isSelected = mcAnswers[qIndex] === oIndex;
                        const isCorrect = oIndex === q.correct;
                        const showAsCorrect = mcChecked && isCorrect;
                        const showAsIncorrect = mcChecked && isSelected && !isCorrect;

                        return (
                          <div
                            key={oIndex}
                            onClick={() => handleMcAnswer(qIndex, oIndex)}
                            className={`answer-option p-3 rounded-lg ${
                              isSelected && !mcChecked ? 'selected' : ''
                            } ${showAsCorrect ? 'correct' : ''} ${showAsIncorrect ? 'incorrect' : ''} ${
                              mcChecked ? 'disabled' : ''
                            }`}
                          >
                            <div className="flex items-center gap-3">
                              <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center ${
                                isSelected && !mcChecked ? 'border-blue-500 bg-blue-500' : 
                                showAsCorrect ? 'border-green-500 bg-green-500' :
                                showAsIncorrect ? 'border-red-500 bg-red-500' :
                                'border-gray-300'
                              }`}>
                                {(isSelected || showAsCorrect) && (
                                  <div className="w-1.5 h-1.5 bg-white rounded-full"></div>
                                )}
                              </div>
                              <span className="font-light flex-1">{option}</span>
                              {showAsCorrect && <span className="text-green-600">‚úì</span>}
                              {showAsIncorrect && <span className="text-red-600">‚úó</span>}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              {!mcChecked ? (
                <button
                  onClick={checkMcAnswers}
                  className="mt-6 bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light"
                >
                  Athuga sv√∂r
                </button>
              ) : (
                <div className="mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-light">
                    ‚úì √û√∫ f√©kkst {mcAnswers.filter((a, i) => a === MULTIPLE_CHOICE[i].correct).length} af {MULTIPLE_CHOICE.length} r√©tt!
                  </p>
                </div>
              )}
            </section>

            {/* 3. Open Questions */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">3Ô∏è‚É£ Opnar spurningar</h2>
              <p className="text-gray-600 font-light mb-6">Svara√∞u spurningunum me√∞ √æ√≠num eigin or√∞um.</p>
              <div className="space-y-6">
                {OPEN_QUESTIONS.map((q, index) => (
                  <div key={index} className="border-2 border-gray-100 rounded-lg p-4">
                    <p className="font-normal text-gray-800 mb-3">{index + 1}. {q.question}</p>
                    <textarea
                      value={openAnswers[index]}
                      onChange={(e) => handleOpenAnswer(index, e.target.value)}
                      disabled={openFeedback[index] !== null}
                      className="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light"
                      rows="3"
                      placeholder="Skrifa√∞u svari√∞ √æitt h√©r..."
                    />
                    
                    {!openFeedback[index] && (
                      <button
                        onClick={() => checkOpenAnswer(index)}
                        disabled={openLoading[index]}
                        className="mt-3 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 disabled:bg-gray-300 transition-colors font-light text-sm"
                      >
                        {openLoading[index] ? 'Athuga...' : 'Athuga svar'}
                      </button>
                    )}

                    {openFeedback[index] && (
                      <div className={`mt-3 p-3 rounded-lg ${
                        openFeedback[index].correct 
                          ? 'bg-green-50 border-2 border-green-200' 
                          : 'bg-yellow-50 border-2 border-yellow-200'
                      }`}>
                        <p className={`text-sm font-light ${
                          openFeedback[index].correct ? 'text-green-800' : 'text-yellow-800'
                        }`}>
                          {openFeedback[index].correct ? '‚úì' : 'üí°'} {openFeedback[index].feedback}
                        </p>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </section>

            {/* 4. True/False */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">4Ô∏è‚É£ R√©tt e√∞a rangt?</h2>
              <div className="space-y-4">
                {TRUE_FALSE.map((item, index) => (
                  <div key={index} className="border-2 border-gray-100 rounded-lg p-4">
                    <p className="font-light text-gray-800 mb-3">{item.statement}</p>
                    <div className="flex gap-4">
                      {[true, false].map((answer) => {
                        const isSelected = tfAnswers[index] === answer;
                        const isCorrect = answer === item.correct;
                        const showAsCorrect = tfChecked && isCorrect;
                        const showAsIncorrect = tfChecked && isSelected && !isCorrect;

                        return (
                          <div
                            key={answer ? 'true' : 'false'}
                            onClick={() => handleTfAnswer(index, answer)}
                            className={`answer-option flex-1 p-3 rounded-lg ${
                              isSelected && !tfChecked ? 'selected' : ''
                            } ${showAsCorrect ? 'correct' : ''} ${showAsIncorrect ? 'incorrect' : ''} ${
                              tfChecked ? 'disabled' : ''
                            }`}
                          >
                            <div className="flex items-center justify-center gap-2">
                              <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center ${
                                isSelected && !tfChecked ? 'border-blue-500 bg-blue-500' : 
                                showAsCorrect ? 'border-green-500 bg-green-500' :
                                showAsIncorrect ? 'border-red-500 bg-red-500' :
                                'border-gray-300'
                              }`}>
                                {(isSelected || showAsCorrect) && (
                                  <div className="w-1.5 h-1.5 bg-white rounded-full"></div>
                                )}
                              </div>
                              <span className="font-light text-sm">{answer ? 'R√©tt' : 'Rangt'}</span>
                              {showAsCorrect && <span className="text-green-600">‚úì</span>}
                              {showAsIncorrect && <span className="text-red-600">‚úó</span>}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
              {!tfChecked ? (
                <button
                  onClick={checkTfAnswers}
                  className="mt-6 bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light"
                >
                  Athuga sv√∂r
                </button>
              ) : (
                <div className="mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-light">
                    ‚úì √û√∫ f√©kkst {tfAnswers.filter((a, i) => a === TRUE_FALSE[i].correct).length} af {TRUE_FALSE.length} r√©tt!
                  </p>
                </div>
              )}
            </section>

            {/* 5. Matching */}
            <section className="bg-white rounded-lg shadow-sm p-8">
              <h2 className="text-2xl font-light text-gray-800 mb-6">5Ô∏è‚É£ Para√∞u saman</h2>
              <div className="space-y-4">
                {MATCHING.map((item, index) => (
                  <div key={index} className="border-2 border-gray-100 rounded-lg p-4">
                    <div className="flex items-center gap-4">
                      <div className="flex-1">
                        <span className="font-normal text-gray-800">{item.left}</span>
                      </div>
                      <div className="text-gray-400">‚Üí</div>
                      <div className="flex-1">
                        <select
                          value={matchingAnswers[index]}
                          onChange={(e) => handleMatchingAnswer(index, e.target.value)}
                          disabled={matchingChecked}
                          className={`w-full p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 font-light ${
                            matchingChecked
                              ? isMatchingCorrect(index)
                                ? 'border-green-500 bg-green-50'
                                : 'border-red-500 bg-red-50'
                              : 'border-gray-300'
                          }`}
                        >
                          <option value="">Veldu...</option>
                          {rightOptions.map((opt, i) => (
                            <option key={i} value={opt}>{opt}</option>
                          ))}
                        </select>
                      </div>
                      {matchingChecked && (
                        <div className="w-8">
                          {isMatchingCorrect(index) ? (
                            <span className="text-green-600 text-xl">‚úì</span>
                          ) : (
                            <span className="text-red-600 text-xl">‚úó</span>
                          )}
                        </div>
                      )}
                    </div>
                    {matchingChecked && !isMatchingCorrect(index) && (
                      <p className="text-sm text-red-600 mt-2">
                        ‚úó R√©tt svar: {item.right}
                      </p>
                    )}
                  </div>
                ))}
              </div>
              {!matchingChecked ? (
                <button
                  onClick={checkMatching}
                  className="mt-6 bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors font-light"
                >
                  Athuga sv√∂r
                </button>
              ) : (
                <div className="mt-6 bg-green-50 border-2 border-green-200 rounded-lg p-4">
                  <p className="text-green-800 font-light">
                    ‚úì √û√∫ f√©kkst {matchingAnswers.filter((_, i) => isMatchingCorrect(i)).length} af {MATCHING.length} r√©tt!
                  </p>
                </div>
              )}
            </section>

            {/* Completion */}
            <div className="bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-200 rounded-lg p-8 text-center">
              <div className="text-6xl mb-4">üéâ</div>
              <h2 className="text-2xl font-light text-gray-800 mb-3">Vel gert!</h2>
              <p className="text-gray-600 font-light">
                √û√∫ hefur kl√°ra√∞ hlustunarverkefni√∞ um fj√∂lskylduna. Hlusta√∞u endilega aftur til a√∞ √¶fa!
              </p>
            </div>

          </main>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<HlustunFjolskyldan />);
  </script>
</body>
</html>
