<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🥚 Páskar – Málstöðin</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(to bottom, #f8f7f4 0%, #e8e6e1 100%);
      min-height: 100vh;
    }
    .answer-option {
      border: 2px solid #e0e0e0;
      transition: all 0.2s;
      cursor: pointer;
    }
    .answer-option:hover:not(.disabled) {
      border-color: #2196f3;
      background: #e3f2fd;
    }
    .answer-option.selected {
      border-color: #2196f3;
      background: #e3f2fd;
    }
    .answer-option.correct {
      border-color: #4caf50;
      background: #e8f5e9;
    }
    .answer-option.incorrect {
      border-color: #f44336;
      background: #ffebee;
    }
    .answer-option.disabled {
      cursor: default;
    }
    .chat-container {
      max-height: 500px;
      overflow-y: auto;
    }
    .chat-container::-webkit-scrollbar {
      width: 6px;
    }
    .chat-container::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    .chat-container::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    async function callOpenAI(payload) {
      const r = await fetch('/.netlify/functions/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
      const data = await r.json();
      if (!r.ok || data.error) throw new Error(data.error || `HTTP ${r.status}`);
      return data.content;
    }

    const READING_TEXT = `Páskarnir eru spennandi tími á Íslandi. Þetta er tími þar sem við fáum frí frá skólanum og vinnu og við getum verið með fjölskyldunni okkar. Margir hlakka til páskanna vegna þess að það er svo margt skemmtilegt að gera. Páskarnir eru bæði trúarleg hátíð og tími til að njóta samveru með fjölskyldunni, en þeir fela í sér margar hefðir sem hafa þróast í gegnum tíðina. Það er tími gleði, vonar og samveru.

Páskarnir eru í raun tveir hlutir í einu. Annars vegar er þetta trúarhátíð. Þá minnumst við þess að Jesús var krossfestur á föstudaginn langa, sem er mjög sorglegur dagur í kristinni trú. Það er dagur þar sem fólk hugsar um fórnir og þjáningar. Hins vegar eru páskarnir líka um von og nýtt líf, því á páskadag reis Jesús upp frá dauðum. Þessi upprisa er talin tákn um sigur lífsins yfir dauðanum og nýtt upphaf.

Áður en páskarnir koma er dymbilvika, vikan á undan páskum. Á skírdag, fimmtudag í dymbilviku, borða margir góðan mat og minnast síðustu kvöldmáltíðar Jesú með lærisveinum sínum. Það er líka tími til að hugsa um hvað er mikilvægt í lífinu, eins og vináttu, fjölskyldu og að vera góður við aðra. Næsta dag er föstudagurinn langi. Þá minnumst við þess þegar Jesús var krossfestur. Á Íslandi er allt lokað á föstudaginn langa og flestir eru heima hjá sér að verja tíma með fjölskyldunni. Næsta sunnudagur er svo Páskadagur en þá reis Jesús upp frá dauðum. Mánudagurinn eftir Páskadag er kallaður Annar í páskum. Þá er frí í skóla og vinnu.

Eitt af því sem börn eru spenntust fyrir er páskaeggið! Páskaegg eru stór súkkulaðiegg full af nammi. Inni í egginu er líka lítill miði með málshætti eða spakmæli. Einn málsháttur er til dæmis "Morgunstund gefur gull í mund" en það þýðir að sá sem vaknar snemma á auðveldara með að eignast peninga. Það er alltaf spennandi að sjá hvað stendur á miðanum! Sumir safna jafnvel þessum miðum. Páskaegg eru seld í mismunandi stærðum og gerðum, svo það er eitthvað fyrir alla.

Fyrir marga er ferming líka mikilvægur hluti af páskunum. Ferming er þegar unglingar staðfesta trú sína í kristinni trú. Þeir læra um trú sína í fermingarfræðslu og halda svo stóra veislu með fjölskyldu og vinum. Þeir fá líka gjafir, oft peninga eða hluti sem þeir óska sér. Ferming er mikilvægur áfangi í lífi margra unglinga.

Það er líka til borgaraleg ferming. Það er ekki trúarleg athöfn, heldur námskeið þar sem unglingar læra um lífið, siðferði og mannréttindi. Þeir læra um mikilvæg málefni eins og jafnrétti, umhverfisvernd og heimsspeki. Eftir námskeiðið er haldin veisla og þeir fá líka gjafir. Þetta er valkostur fyrir þá sem vilja ekki fermast í kirkju.

Páskarnir eru tími til að vera saman, borða góðan mat, gefa gjafir og njóta frísins. Margar fjölskyldur fara í ferðalög um páskana, annað hvort innanlands eða utan. Aðrir kjósa að vera heima og njóta samverunnar. Hvort sem þú fagnar páskunum sem trúarhátíð eða bara sem tíma til að vera með fjölskyldunni, þá eru páskarnir alltaf sérstakir. Gleðilega páska!`;

    const MULTIPLE_CHOICE = [
      {
        question: 'Hvað er dymbilvika?',
        options: [
          'Vikan eftir páska.',
          'Vikan fyrir páska.',
          'Súkkulaðiegg fullt af nammi.',
          'Dagurinn þegar Jesús reis upp frá dauðum.'
        ],
        correct: 1
      },
      {
        question: 'Hvað er inni í páskaegginu samkvæmt textanum?',
        options: [
          'Lítill bíll.',
          'Lítill miði með spakmæli.',
          'Lítill bangsi.',
          'Lítill gullpeningur.'
        ],
        correct: 1
      },
      {
        question: 'Hvað gera unglingar í borgaralegri fermingu?',
        options: [
          'Þeir læra um trú sína.',
          'Þeir læra um lífið, siðferði og mannréttindi.',
          'Þeir borða góðan mat.',
          'Þeir fá trúarlega gjöf.'
        ],
        correct: 1
      }
    ];

    const SHORT_OPEN_QUESTIONS = [
      'Af hverju hlakka margir til páskanna?',
      'Hvers minnast margir á skírdag samkvæmt textanum?',
      'Hvað er ferming?'
    ];

    const DISCUSSION_QUESTIONS = [
      'Í textanum er talað um að páskarnir séu tími til að vera með fjölskyldunni og njóta frísins. Hvað finnst þér skemmtilegast að gera með fjölskyldunni þinni yfir páskana eða á öðrum hátíðisdögum? Hefur þú einhverjar sérstakar hefðir?',
      'Textinn nefnir bæði trúarlega og borgaralega fermingu. Ef þú hefur farið í fermingu eða þekkir einhvern sem hefur fermst, hvað fannst þér áhugaverðast eða eftirminnilegast við þá upplifun?',
      'Í textanum er minnst á páskaegg og málshætti. Hvað finnst þér skemmtilegast við páskaegg, og hefur þú einhvern tíma fengið málshátt sem hafði áhrif á þig eða þér fannst fyndinn?'
    ];

    const Paskar = () => {
      const [stage, setStage] = useState('reading');
      const [mcAnswers, setMcAnswers] = useState([]);
      const [showMcFeedback, setShowMcFeedback] = useState(false);
      
      const [shortAnswers, setShortAnswers] = useState(['', '', '']);
      const [shortFeedback, setShortFeedback] = useState([null, null, null]);
      const [shortLoading, setShortLoading] = useState([false, false, false]);
      
      const [conversations, setConversations] = useState([[], [], []]);
      const [currentInputs, setCurrentInputs] = useState(['', '', '']);
      const [loadingStates, setLoadingStates] = useState([false, false, false]);
      
      const chatRefs = [useRef(null), useRef(null), useRef(null)];

      const handleMcAnswer = (questionIndex, optionIndex) => {
        if (showMcFeedback) return;
        const newAnswers = [...mcAnswers];
        newAnswers[questionIndex] = optionIndex;
        setMcAnswers(newAnswers);
      };

      const checkMcAnswers = () => {
        if (mcAnswers.length < MULTIPLE_CHOICE.length) {
          alert('Vinsamlegast svaraðu öllum spurningum!');
          return;
        }
        setShowMcFeedback(true);
      };

      const continueToShortQuestions = () => {
        setStage('short');
      };

      const continueToDiscussion = () => {
        setStage('discussion');
      };

      const handleShortAnswerChange = (index, value) => {
        const newAnswers = [...shortAnswers];
        newAnswers[index] = value;
        setShortAnswers(newAnswers);
      };

      const getShortFeedback = async (questionIndex) => {
        const question = SHORT_OPEN_QUESTIONS[questionIndex];
        const answer = shortAnswers[questionIndex];

        if (!answer.trim() || answer.trim().length < 3) {
          alert('Vinsamlegast skrifaðu svar (að minnsta kosti nokkur orð)');
          return;
        }

        const newLoading = [...shortLoading];
        newLoading[questionIndex] = true;
        setShortLoading(newLoading);

        try {
          const sys = `Þú ert vingjarnlegur íslenskukennari sem er að fara yfir stutt svör nemanda (A1-A2 stig).

TEXTINN SEM NEMANDINN LAS:
"${READING_TEXT}"

SPURNINGIN:
"${question}"

SVAR NEMANDANS:
"${answer}"

VERKEFNI:
Gefðu hvetjandi endurgjöf (2-3 setningar á íslensku):
1. Byrjaðu með jákvæðu (t.d. "Gott!", "Frábært!")
2. Ef svarið er rétt eða nálægt því - hrósaðu og staðfestu
3. Ef svarið er rangt eða ónákvæmt - leiðréttu á mjúkan hátt og útskýrðu rétta svarið út frá textanum

DÆMI:
Ef svar er rétt: "Frábært! Þú hefur alveg rétt fyrir þér - í textanum segir að margir hlakki til páskanna vegna þess að það er svo margt skemmtilegt að gera!"
Ef svar er rangt: "Góð tilraun! En í textanum segir að margir minni síðustu kvöldmáltíðar Jesú með lærisveinum sínum á skírdag."

REGLUR:
- Alltaf jákvæður og hvetjandi tónn
- Einföld íslenska (A1-A2)
- Vísa alltaf í textann
- 2-3 setningar

SKILAÐU BARA TEXTANUM, ekkert JSON eða annað.`.trim();

          const response = await callOpenAI({
            model: 'gpt-4o',
            temperature: 0.5,
            max_tokens: 150,
            messages: [
              { role: 'system', content: sys },
              { role: 'user', content: 'Gefðu endurgjöf' }
            ]
          });

          const newFeedback = [...shortFeedback];
          newFeedback[questionIndex] = response.trim();
          setShortFeedback(newFeedback);
        } catch (e) {
          console.error('Short feedback error:', e);
          alert('Villa við að fá endurgjöf. Reyndu aftur.');
        } finally {
          const newLoading = [...shortLoading];
          newLoading[questionIndex] = false;
          setShortLoading(newLoading);
        }
      };

      const scrollToBottom = (index) => {
        setTimeout(() => {
          if (chatRefs[index].current) {
            chatRefs[index].current.scrollTop = chatRefs[index].current.scrollHeight;
          }
        }, 100);
      };

      const handleInputChange = (index, value) => {
        const newInputs = [...currentInputs];
        newInputs[index] = value;
        setCurrentInputs(newInputs);
      };

      const sendMessage = async (questionIndex) => {
        const message = currentInputs[questionIndex].trim();
        if (!message) return;

        const newConversations = [...conversations];
        newConversations[questionIndex] = [
          ...newConversations[questionIndex],
          { role: 'user', content: message }
        ];
        setConversations(newConversations);

        const newInputs = [...currentInputs];
        newInputs[questionIndex] = '';
        setCurrentInputs(newInputs);

        const newLoading = [...loadingStates];
        newLoading[questionIndex] = true;
        setLoadingStates(newLoading);

        scrollToBottom(questionIndex);

        try {
          const question = DISCUSSION_QUESTIONS[questionIndex];
          const isFirstMessage = newConversations[questionIndex].length === 1;

          const systemPrompt = `Þú ert vingjarnlegur íslenskukennari sem ræðir við A1-A2 nemanda um páska á Íslandi.

TEXTINN SEM NEMANDINN LAS:
"${READING_TEXT}"

UPPRUNALEGA SPURNINGIN:
"${question}"

VERKEFNI:
${isFirstMessage ? `1. Lestu fyrsta svar nemandans og gefðu hvetjandi, jákvæða endurgjöf
2. Kommentaðu á efninu - hvað er áhugavert?
3. Spyrðu einfalda follow-up spurningu` : `1. Haltu áfram samtali við nemandann
2. Svaraðu spurningum hans á náttúrulegan hátt
3. Vertu hvetjandi og hjálpsamur`}

REGLUR:
- Vertu ALLTAF jákvæður og hvetjandi
- Haltu því stuttu (2-4 setningar)
- Notaðu einfalda íslensku (A1-A2 stig)
- Notaðu bara íslensku
- ALDREI gefa einkunn

SVARAÐU MEÐ JSON Á ÞESSU FORMI:
{
  "grammar": "Málfarsendurgjöf BARA ef það eru GRÓFAR villur (beygingarvillur, rangt orðval). Vertu mjög mild og hvetjandi (1-2 setningar). Ef ekkert athugavert, settu null.",
  "response": "Aðal svarið þitt hér"
}

DÆMI á grammar:
- Gott: "Frábært! *'Ég fer í sund' er réttara en 'ég fer á sund'.*"
- Slæmt: "Rangur punktur", "Vantar kommu"
- ALDREI pikka í greinarmerki eða smávillur
- ALDREI ef setningin er eðlileg í samhengi`;

          const messages = [
            { role: 'system', content: systemPrompt },
            ...newConversations[questionIndex]
              .filter(msg => msg.role === 'user' || msg.role === 'assistant')
              .map(msg => ({
                role: msg.role,
                content: msg.role === 'assistant' ? msg.content : msg.content
              }))
          ];

          const response = await callOpenAI({
            model: 'gpt-4o',
            temperature: 0.7,
            max_tokens: 300,
            messages: messages
          });

          let cleanResult = response.trim();
          if (cleanResult.startsWith('```')) {
            cleanResult = cleanResult.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
          }
          
          const parsed = JSON.parse(cleanResult);

          let currentConversations = [...newConversations];
          if (parsed.grammar) {
            currentConversations[questionIndex] = [
              ...currentConversations[questionIndex],
              { role: 'grammar', content: parsed.grammar }
            ];
            setConversations(currentConversations);
            scrollToBottom(questionIndex);
            
            await new Promise(resolve => setTimeout(resolve, 400));
          }

          const updatedConversations = [...currentConversations];
          updatedConversations[questionIndex] = [
            ...updatedConversations[questionIndex],
            { role: 'assistant', content: parsed.response }
          ];
          setConversations(updatedConversations);
          
          scrollToBottom(questionIndex);

        } catch (e) {
          console.error('Chat error:', e);
          alert('Villa við að senda skilaboð. Reyndu aftur.');
          
          const rollbackConversations = [...conversations];
          rollbackConversations[questionIndex] = newConversations[questionIndex].slice(0, -1);
          setConversations(rollbackConversations);
        } finally {
          const newLoading = [...loadingStates];
          newLoading[questionIndex] = false;
          setLoadingStates(newLoading);
        }
      };

      const handleKeyPress = (e, questionIndex) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage(questionIndex);
        }
      };

      const allShortQuestionsAnswered = shortFeedback.every(f => f !== null);

      return (
        <div className="min-h-screen pb-12">
          <header className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-6 py-8">
              <button 
                onClick={() => window.history.back()} 
                className="text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block font-light"
              >
                ← Til baka
              </button>
              <h1 className="text-3xl font-light text-gray-800 mb-2">Páskar</h1>
              <p className="text-gray-500 text-sm font-light">Lesskilningur og umræða · A1-A2</p>
            </div>
          </header>

          <main className="max-w-4xl mx-auto px-6 mt-8">
            {stage === 'reading' && (
              <div className="space-y-6">
                <div className="bg-white rounded-lg shadow-sm p-8">
                  <div className="text-center mb-8">
                    <div className="text-6xl mb-4">🥚</div>
                    <h2 className="text-2xl font-light text-gray-800 mb-4">Lestu textann</h2>
                  </div>

                  <div className="prose max-w-none mb-8">
                    {READING_TEXT.split('\n\n').map((para, i) => (
                      <p key={i} className="text-gray-700 leading-relaxed mb-4 font-light">
                        {para}
                      </p>
                    ))}
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow-sm p-8">
                  <h2 className="text-2xl font-light text-gray-800 mb-6">Krossaspurningar</h2>

                  <div className="space-y-8">
                    {MULTIPLE_CHOICE.map((q, qIndex) => (
                      <div key={qIndex} className="border-2 border-gray-100 rounded-lg p-6">
                        <p className="font-normal text-gray-800 mb-4 text-lg">
                          {qIndex + 1}. {q.question}
                        </p>
                        <div className="space-y-3">
                          {q.options.map((option, oIndex) => {
                            const isSelected = mcAnswers[qIndex] === oIndex;
                            const isCorrect = oIndex === q.correct;
                            const showAsCorrect = showMcFeedback && isCorrect;
                            const showAsIncorrect = showMcFeedback && isSelected && !isCorrect;

                            return (
                              <div
                                key={oIndex}
                                onClick={() => handleMcAnswer(qIndex, oIndex)}
                                className={`answer-option p-4 rounded-lg ${
                                  isSelected && !showMcFeedback ? 'selected' : ''
                                } ${showAsCorrect ? 'correct' : ''} ${showAsIncorrect ? 'incorrect' : ''} ${
                                  showMcFeedback ? 'disabled' : ''
                                }`}
                              >
                                <div className="flex items-start gap-3">
                                  <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center mt-0.5 flex-shrink-0 ${
                                    isSelected && !showMcFeedback ? 'border-blue-500 bg-blue-500' : 
                                    showAsCorrect ? 'border-green-500 bg-green-500' :
                                    showAsIncorrect ? 'border-red-500 bg-red-500' :
                                    'border-gray-300'
                                  }`}>
                                    {(isSelected || showAsCorrect) && (
                                      <div className="w-2 h-2 bg-white rounded-full"></div>
                                    )}
                                  </div>
                                  <span className="font-light flex-1">{option}</span>
                                  {showAsCorrect && <span className="text-green-600 text-xl">✓</span>}
                                  {showAsIncorrect && <span className="text-red-600 text-xl">✗</span>}
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    ))}
                  </div>

                  {!showMcFeedback ? (
                    <div className="text-center mt-8">
                      <button
                        onClick={checkMcAnswers}
                        className="bg-gray-800 text-white px-8 py-3 rounded-md hover:bg-gray-700 transition-colors font-light text-lg"
                      >
                        Athuga svör
                      </button>
                    </div>
                  ) : (
                    <div className="mt-8">
                      <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6">
                        <div className="flex items-start gap-3">
                          <span className="text-3xl">
                            {mcAnswers.every((a, i) => a === MULTIPLE_CHOICE[i].correct) ? '🎉' : '💪'}
                          </span>
                          <div>
                            <h3 className="font-normal text-gray-800 mb-2">
                              {mcAnswers.every((a, i) => a === MULTIPLE_CHOICE[i].correct) 
                                ? 'Frábært! Öll svörin eru rétt!' 
                                : 'Góð tilraun! Skoðaðu svörin og reyndu aftur ef þú vilt.'}
                            </h3>
                            <p className="text-sm text-gray-600 font-light">
                              Þú fékkst {mcAnswers.filter((a, i) => a === MULTIPLE_CHOICE[i].correct).length} af {MULTIPLE_CHOICE.length} rétt.
                            </p>
                          </div>
                        </div>
                      </div>
                      <div className="text-center">
                        <button
                          onClick={continueToShortQuestions}
                          className="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-md hover:from-blue-600 hover:to-blue-700 transition-all font-light text-lg"
                        >
                          Halda áfram →
                        </button>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}

            {stage === 'short' && (
              <div className="bg-white rounded-lg shadow-sm p-8">
                <div className="text-center mb-8">
                  <div className="text-6xl mb-4">📝</div>
                  <h2 className="text-2xl font-light text-gray-800 mb-4">Stuttar spurningar</h2>
                  <p className="text-gray-600 font-light">
                    Svaraðu spurningunum út frá textanum
                  </p>
                </div>

                <div className="space-y-8">
                  {SHORT_OPEN_QUESTIONS.map((question, index) => (
                    <div key={index} className="border-2 border-gray-100 rounded-lg p-6">
                      <p className="font-normal text-gray-800 mb-4 text-lg">
                        {index + 1}. {question}
                      </p>
                      <textarea
                        value={shortAnswers[index]}
                        onChange={(e) => handleShortAnswerChange(index, e.target.value)}
                        disabled={shortFeedback[index] !== null}
                        className="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none font-light text-base mb-4 disabled:bg-gray-50"
                        rows="3"
                        placeholder="Skrifaðu svarið þitt hér..."
                      />

                      {!shortFeedback[index] ? (
                        <button
                          onClick={() => getShortFeedback(index)}
                          disabled={shortLoading[index] || shortAnswers[index].trim().length < 3}
                          className="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-light"
                        >
                          {shortLoading[index] ? 'Bíð...' : 'Fá endurgjöf'}
                        </button>
                      ) : (
                        <div className="bg-green-50 border-2 border-green-200 rounded-lg p-4">
                          <div className="flex items-start gap-3">
                            <span className="text-2xl">✨</span>
                            <div className="flex-1">
                              <p className="text-gray-800 font-light leading-relaxed">
                                {shortFeedback[index]}
                              </p>
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  ))}
                </div>

                {allShortQuestionsAnswered && (
                  <div className="text-center mt-8">
                    <button
                      onClick={continueToDiscussion}
                      className="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-md hover:from-blue-600 hover:to-blue-700 transition-all font-light text-lg"
                    >
                      Halda áfram í umræðuspurningar →
                    </button>
                  </div>
                )}
              </div>
            )}

            {stage === 'discussion' && (
              <div className="space-y-6">
                <div className="text-center mb-8 bg-white rounded-lg shadow-sm p-8">
                  <div className="text-6xl mb-4">💬</div>
                  <h2 className="text-2xl font-light text-gray-800 mb-4">Umræðuspurningar</h2>
                  <p className="text-gray-600 font-light">
                    Svaraðu spurningunum og haltu samtali áfram!
                  </p>
                </div>

                {DISCUSSION_QUESTIONS.map((question, index) => (
                  <div key={index} className="bg-white rounded-lg shadow-sm p-6">
                    <p className="font-normal text-gray-800 mb-4 text-lg">
                      {index + 1}. {question}
                    </p>

                    <div 
                      ref={chatRefs[index]}
                      className="chat-container mb-4 space-y-3"
                    >
                      {conversations[index].map((msg, msgIndex) => (
                        <div key={msgIndex}>
                          {msg.role === 'user' ? (
                            <div className="flex justify-end">
                              <div className="bg-blue-50 rounded-lg p-4 max-w-[80%]">
                                <p className="text-gray-800 font-light">{msg.content}</p>
                              </div>
                            </div>
                          ) : msg.role === 'grammar' ? (
                            <div className="flex justify-center">
                              <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 max-w-[85%]">
                                <div className="flex items-start gap-2">
                                  <span className="text-lg">📚</span>
                                  <p className="text-sm text-gray-700 font-light">
                                    <span className="font-normal">Málfar:</span> {msg.content}
                                  </p>
                                </div>
                              </div>
                            </div>
                          ) : (
                            <div className="flex justify-start">
                              <div className="bg-green-50 border border-green-200 rounded-lg p-4 max-w-[80%]">
                                <div className="flex items-start gap-2">
                                  <span className="text-xl">✨</span>
                                  <p className="text-gray-800 font-light">{msg.content}</p>
                                </div>
                              </div>
                            </div>
                          )}
                        </div>
                      ))}
                      
                      {loadingStates[index] && (
                        <div className="flex justify-start">
                          <div className="bg-gray-100 rounded-lg p-4">
                            <p className="text-gray-500 font-light">Bíð...</p>
                          </div>
                        </div>
                      )}
                    </div>

                    <div className="flex gap-2">
                      <textarea
                        value={currentInputs[index]}
                        onChange={(e) => handleInputChange(index, e.target.value)}
                        onKeyPress={(e) => handleKeyPress(e, index)}
                        disabled={loadingStates[index]}
                        className="flex-1 p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none font-light text-base disabled:bg-gray-50"
                        rows="2"
                        placeholder={conversations[index].length === 0 ? "Skrifaðu svarið þitt hér..." : "Haltu áfram að spjalla..."}
                      />
                      <button
                        onClick={() => sendMessage(index)}
                        disabled={loadingStates[index] || !currentInputs[index].trim()}
                        className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-light self-end"
                      >
                        {conversations[index].length === 0 ? 'Fá endurgjöf' : 'Senda'}
                      </button>
                    </div>
                  </div>
                ))}

                <div className="text-center mt-8">
                  <button
                    onClick={() => window.history.back()}
                    className="bg-gray-800 text-white px-8 py-3 rounded-md hover:bg-gray-700 transition-colors font-light text-lg"
                  >
                    ← Til baka
                  </button>
                </div>
              </div>
            )}
          </main>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<Paskar />);
  </script>
</body>
</html>
